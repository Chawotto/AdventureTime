name: üöÄ Build and Deploy to Railway

on:
  push:
    branches:
      - main

jobs:
  build-and-deploy:
    runs-on: ubuntu-latest

    steps:
      # –ö–ª–æ–Ω–∏—Ä—É–µ–º —Ä–µ–ø–æ–∑–∏—Ç–æ—Ä–∏–π
      - name: Checkout code
        uses: actions/checkout@v3

      # –£—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ–º Java 17
      - name: Set up JDK 17
        uses: actions/setup-java@v3
        with:
          distribution: temurin
          java-version: 17

      # –î–∞–µ–º –ø—Ä–∞–≤–∞ –Ω–∞ –≤—ã–ø–æ–ª–Ω–µ–Ω–∏–µ mvnw
      - name: Grant execute permission for mvnw
        run: chmod +x mvnw

      # –°–æ–±–∏—Ä–∞–µ–º –ø—Ä–æ–µ–∫—Ç —á–µ—Ä–µ–∑ Maven
      - name: Build with Maven
        run: ./mvnw clean package -DskipTests

      # –î–µ–ø–ª–æ–π –Ω–∞ Railway —á–µ—Ä–µ–∑ –æ—Ñ–∏—Ü–∏–∞–ª—å–Ω—ã–π Action
      - name: Deploy to Railway
        uses: railwayapp/cli-action@v1.8.0
        with:
          railwayToken: ${{ secrets.RAILWAY_TOKEN }}
          projectId: ${{ secrets.RAILWAY_PROJECT_ID }}
          command: up
