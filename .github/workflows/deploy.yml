name: üöÄ Build and Deploy to Railway

on:
  push:
    branches:
      - master

jobs:
  build-and-deploy:
    runs-on: ubuntu-latest

    steps:
      # 1. –ö–ª–æ–Ω–∏—Ä—É–µ–º –∫–æ–¥ —Ä–µ–ø–æ–∑–∏—Ç–æ—Ä–∏—è
      - name: Checkout code
        uses: actions/checkout@v3

      # 2. –£—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ–º JDK 17
      - name: Set up JDK 17
        uses: actions/setup-java@v3
        with:
          distribution: temurin
          java-version: 17

      # 3. –°–±–æ—Ä–∫–∞ –ø—Ä–æ–µ–∫—Ç–∞ —á–µ—Ä–µ–∑ Maven
      - name: Build with Maven
        run: ./mvnw clean package -DskipTests

      # 4. –£—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ–º Railway CLI
      - name: Install Railway CLI
        run: |
          curl -fsSL https://railway.app/install.sh | sh

      # 5. –õ–æ–≥–∏–Ω–∏–º—Å—è –≤ Railway —á–µ—Ä–µ–∑ API-—Ç–æ–∫–µ–Ω
      - name: Railway Login
        run: railway login --apiKey ${{ secrets.RAILWAY_TOKEN }}

      # 6. –î–µ–ø–ª–æ–π –Ω–∞ Railway
      - name: Deploy to Railway
        run: railway up --service ${{ secrets.RAILWAY_SERVICE_ID }}
